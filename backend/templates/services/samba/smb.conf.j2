# Samba Configuration Generated by MoxNAS
# Generated at: {{ generation_time }}
# DO NOT EDIT MANUALLY - Changes will be overwritten

[global]
    # Server identification
    workgroup = {{ workgroup|default('WORKGROUP') }}
    server string = {{ server_string|default('MoxNAS Server') }}
    netbios name = {{ netbios_name|default('MOXNAS') }}
    
    # Protocol versions
    min protocol = SMB2
    max protocol = SMB3
    
    # Authentication
    security = user
    map to guest = {{ map_to_guest|default('Bad User') }}
    guest account = nobody
    
    # Logging
    log file = /var/log/samba/log.%m
    max log size = 1000
    log level = 1
    
    # Performance
    socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072
    use sendfile = yes
    aio read size = 16384
    aio write size = 16384
    
    # Network
    bind interfaces only = {{ bind_interfaces_only|default('no') }}
    interfaces = {{ interfaces|default('lo eth0') }}
    
    # File system options
    unix extensions = yes
    wide links = no
    follow symlinks = yes
    
    # Recycle bin (if enabled globally)
    {% if recycle_bin_enabled %}
    vfs objects = recycle
    recycle:repository = .recycle
    recycle:keeptree = yes
    recycle:versions = yes
    {% endif %}

# Share definitions
{% for share in shares %}
[{{ share.name }}]
    comment = {{ share.comment|default('MoxNAS Share') }}
    path = {{ share.path }}
    valid users = {{ share.valid_users|join(' ') if share.valid_users else '@users' }}
    
    # Access control
    read only = {{ 'yes' if share.read_only else 'no' }}
    browseable = {{ 'yes' if share.browseable else 'no' }}
    guest ok = {{ 'yes' if share.guest_ok else 'no' }}
    
    # File permissions
    create mask = {{ share.create_mask|default('0664') }}
    directory mask = {{ share.directory_mask|default('0775') }}
    force user = {{ share.force_user if share.force_user else '' }}
    force group = {{ share.force_group if share.force_group else '' }}
    
    # Advanced options
    {% if share.hide_dot_files %}
    hide dot files = yes
    {% endif %}
    
    {% if share.inherit_permissions %}
    inherit permissions = yes
    {% endif %}
    
    {% if share.recycle_bin %}
    vfs objects = recycle
    recycle:repository = .recycle
    recycle:keeptree = yes
    recycle:versions = yes
    {% endif %}
    
    {% if share.audit %}
    vfs objects = full_audit
    full_audit:prefix = %u|%I|%m|%S
    full_audit:success = open opendir read write rename unlink rmdir mkdir
    full_audit:failure = all
    full_audit:facility = local5
    full_audit:priority = notice
    {% endif %}

{% endfor %}