# vsftpd Configuration Generated by MoxNAS
# Generated at: {{ generation_time }}
# DO NOT EDIT MANUALLY - Changes will be overwritten

# Basic settings
listen=YES
listen_ipv6=NO
anonymous_enable={{ 'YES' if anonymous_enable else 'NO' }}
local_enable=YES
write_enable={{ 'YES' if write_enable else 'NO' }}
local_umask={{ local_umask|default('022') }}

# Anonymous user settings
{% if anonymous_enable %}
anon_upload_enable={{ 'YES' if anon_upload_enable else 'NO' }}
anon_mkdir_write_enable={{ 'YES' if anon_mkdir_write_enable else 'NO' }}
anon_root={{ anon_root|default('/srv/ftp') }}
no_anon_password={{ 'YES' if no_anon_password else 'NO' }}
{% endif %}

# Logging
dirmessage_enable=YES
use_localtime=YES
xferlog_enable=YES
xferlog_file=/var/log/vsftpd.log
xferlog_std_format=YES

# Security
connect_from_port_20=YES
chroot_local_user={{ 'YES' if chroot_local_user else 'NO' }}
allow_writeable_chroot=YES
secure_chroot_dir=/var/run/vsftpd/empty

# SSL/TLS Configuration
{% if ssl_enable %}
ssl_enable=YES
allow_anon_ssl=NO
force_local_data_ssl=YES
force_local_logins_ssl=YES
ssl_tlsv1=YES
ssl_sslv2=NO
ssl_sslv3=NO
rsa_cert_file={{ ssl_cert_file|default('/etc/ssl/certs/vsftpd.pem') }}
rsa_private_key_file={{ ssl_key_file|default('/etc/ssl/private/vsftpd.key') }}
{% endif %}

# Passive mode configuration
pasv_enable=YES
pasv_min_port={{ pasv_min_port|default('20000') }}
pasv_max_port={{ pasv_max_port|default('20100') }}
pasv_address={{ pasv_address if pasv_address else '' }}

# User management
pam_service_name=vsftpd
userlist_enable=YES
userlist_file=/etc/vsftpd.userlist
userlist_deny={{ 'YES' if userlist_deny else 'NO' }}

# Performance
use_sendfile=YES
tcp_wrappers=YES

# Custom options
{% for key, value in custom_options.items() %}
{{ key }}={{ value }}
{% endfor %}