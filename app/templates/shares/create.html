{% extends "base.html" %}

{% block title %}Create Share - MoxNAS{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2"><i class="bi bi-plus-circle"></i> Create New Share</h1>
            <a href="{{ url_for('shares.index') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Shares
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-8 col-lg-10">
        <div class="card shadow">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">Share Configuration</h6>
            </div>
            <div class="card-body">
                <form method="POST" class="needs-validation" novalidate>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token else '' }}"/>
                    
                    <!-- Basic Information -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2">Basic Information</h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">Share Name *</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                            <div class="invalid-feedback">
                                Please provide a valid share name.
                            </div>
                            <div class="form-text">Unique name for this share</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="description" class="form-label">Description</label>
                            <input type="text" class="form-control" id="description" name="description">
                            <div class="form-text">Optional description for this share</div>
                        </div>
                    </div>
                    
                    <!-- Protocol Selection -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2">Protocol Configuration</h6>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="protocol" class="form-label">Protocol *</label>
                            <select class="form-select" id="protocol" name="protocol" required>
                                <option value="">Select protocol...</option>
                                {% for value, label in protocols %}
                                <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">
                                Please select a protocol.
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="dataset_id" class="form-label">Dataset *</label>
                            <select class="form-select" id="dataset_id" name="dataset_id" required>
                                <option value="">Select dataset...</option>
                                {% for dataset in datasets %}
                                <option value="{{ dataset.id }}">{{ dataset.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">
                                Please select a dataset.
                            </div>
                            <div class="form-text">Dataset to share</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="enabled" name="enabled" checked>
                                <label class="form-check-label" for="enabled">
                                    Enable Share
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Access Control -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2">Access Control</h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="guest_access" name="guest_access">
                                <label class="form-check-label" for="guest_access">
                                    Allow Guest Access
                                </label>
                            </div>
                            <div class="form-text">Allow anonymous access to this share</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="read_only" name="read_only">
                                <label class="form-check-label" for="read_only">
                                    Read Only
                                </label>
                            </div>
                            <div class="form-text">Prevent write access to this share</div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <label for="allowed_hosts" class="form-label">Allowed Hosts</label>
                            <textarea class="form-control" id="allowed_hosts" name="allowed_hosts" rows="3" 
                                    placeholder="192.168.1.0/24&#10;10.0.0.100&#10;*.example.com"></textarea>
                            <div class="form-text">One host/network per line. Leave empty to allow all hosts.</div>
                        </div>
                    </div>
                    
                    <!-- Advanced Options -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#advancedOptions" aria-expanded="false">
                                <i class="bi bi-gear"></i> Advanced Options
                            </button>
                        </div>
                    </div>
                    
                    <div class="collapse" id="advancedOptions">
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="max_connections" class="form-label">Max Connections</label>
                                <input type="number" class="form-control" id="max_connections" 
                                       name="max_connections" min="1" max="1000" value="100">
                                <div class="form-text">Maximum simultaneous connections</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="bandwidth_limit" class="form-label">Bandwidth Limit (MB/s)</label>
                                <input type="number" class="form-control" id="bandwidth_limit" 
                                       name="bandwidth_limit" min="0" step="0.1">
                                <div class="form-text">0 = unlimited</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Submit Buttons -->
                    <div class="row">
                        <div class="col-12">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="{{ url_for('shares.index') }}" class="btn btn-secondary me-md-2">
                                    Cancel
                                </a>
                                <button class="btn btn-primary" type="submit">
                                    <i class="bi bi-check-circle"></i> Create Share
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-xl-4 col-lg-2">
        <div class="card shadow">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-info">Protocol Information</h6>
            </div>
            <div class="card-body">
                <div id="protocol-info">
                    <div class="protocol-help" data-protocol="smb">
                        <h6 class="text-primary">SMB/CIFS Share</h6>
                        <ul class="small">
                            <li>Windows native file sharing</li>
                            <li>Good for Windows and mixed environments</li>
                            <li>Supports authentication and access control</li>
                        </ul>
                    </div>
                    
                    <div class="protocol-help" data-protocol="nfs" style="display: none;">
                        <h6 class="text-primary">NFS Share</h6>
                        <ul class="small">
                            <li>Network File System</li>
                            <li>Excellent for Unix/Linux environments</li>
                            <li>High performance, low overhead</li>
                        </ul>
                    </div>
                    
                    <div class="protocol-help" data-protocol="ftp" style="display: none;">
                        <h6 class="text-primary">FTP Share</h6>
                        <ul class="small">
                            <li>File Transfer Protocol</li>
                            <li>Universal compatibility</li>
                            <li>Good for file distribution</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6 class="text-warning">Tips</h6>
                    <ul class="small">
                        <li>Choose meaningful share names</li>
                        <li>Test connectivity after creation</li>
                        <li>Monitor share usage regularly</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Show protocol-specific help
document.getElementById('protocol').addEventListener('change', function() {
    const selectedProtocol = this.value;
    const helpDivs = document.querySelectorAll('.protocol-help');
    
    helpDivs.forEach(div => {
        if (div.dataset.protocol === selectedProtocol) {
            div.style.display = 'block';
        } else {
            div.style.display = 'none';
        }
    });
});

// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}